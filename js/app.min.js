var XHRCache={},timeoutfunc=function(e){void 0!==e.srcElement&&void 0!==e.srcElement.url&&delete XHRCache[e.srcElement.url]};function APIData(url,func){if(void 0!==XHRCache[url])return!1;"http"===url.substring(0,4)&&"s"!==url[4]&&(url="https"+url.substring(4));var xhr=new XMLHttpRequest;return xhr.open("GET",url,!0),xhr.onreadystatechange=function(){if(4===xhr.readyState){if(200===xhr.status)try{func(JSON.parse(xhr.responseText))}catch(e){func(!1)}delete XHRCache[url]}},xhr.url=url,xhr.timeout=5e3,xhr.addEventListener("timeout",timeoutfunc),xhr.send(),XHRCache[url]=xhr,!0}var ProcessLoad=function(json,m){void 0!==m[0]&&Vue.set(m[0],m[1],json)};Vue.use({install:function(Vue,o){Vue.prototype.$t=lang}}),window.addEventListener("load",function(){var Cache={},Types={},Main=new Vue({el:"#main",data:{items:[],select:{},selected:!1},mounted:function(){var self=this;APIData("https://swapi.dev/api/",function(json){if(json)for(var btn in json)Types[btn]=self.items.length,self.items.push({id:btn,part:void 0!==self.$t[btn]?self.$t[btn]:btn,url:json[btn],expanded:!1})}),this.forcePage()},methods:{expand:function(id,url,main,cb){id=Types[id];var self,item=this.items[id];main&&item.expand?item.expanded=!item.expanded:(self=this,APIData(url,function(json){if(json){if(item.count=json.count,item.nexturl=json.next,item.prevurl=json.previous,item.expand)for(var rid in json.results){var res=json.results[rid];self.cacheElement(res),item.expand.push(res)}else{var rz=[];for(var rid in json.results){res=json.results[rid];self.cacheElement(res),rz.push(res)}Vue.set(item,"expand",rz)}main&&(item.expanded=!0),void 0!==cb&&cb[0](json,cb[1],cb[2])}}))},subview:function(id,subid,nb){var curloc,sub=Cache[id][subid],st={};for(var att in sub)if("_id"!==att&&"_type"!==att){var val=sub[att];if("string"==typeof val&&"url"!==att&&"http"===val.substring(0,4)&&(val=[val]),"object"==typeof val){var sar=[];for(var subi in val){var subg=val[subi];if(void 0===subg)break;var selem=this.getElement(subg,ProcessLoad,[sar,sar.length]);!1!==selem?sar.push(selem):sar.push(subg)}val=sar}void 0!==this.$t[att]&&(att=this.$t[att]),st[att]=val}this.select=st,this.selected=!0,nb||((curloc=new URLSearchParams(location.search)).set("type",id),curloc.set("id",subid),window.history.pushState({type:id,id:subid},"",location.pathname+"?"+curloc))},getElement:function(url,func,args){var at=this.infoElement(url);return Cache[at[0]]&&Cache[at[0]][at[1]]?Cache[at[0]][at[1]]:(this.queueElement(url,func,args),!1)},infoElement:function(url){var spl=url.split("/"),id=spl.pop();return""===id&&(id=spl.pop()),[spl.pop(),id]},cacheElement:function(el){var at=this.infoElement(el.url),type=at[0];void 0===Cache[type]&&(Cache[type]={}),el._type=type,el._id=at[1],Cache[type][at[1]]=el},queueElement:function(url,func,arr){var self;void 0!==func&&(self=this,APIData(url,function(json){json&&(self.cacheElement(json),func(json,arr))}))},forcePage:function(e){void 0!==e&&e.preventDefault();var search=new URL(document.location).searchParams,type=search.get("type"),id=search.get("id");null!==type&&null!==id&&this.getElement("https://swapi.dev/api/"+type+"/"+id+"/",this.popState,[type,id])&&this.subview(type,id,!0)},popState:function(json,m){json&&this.subview(m[0],m[1],!0)},loadStatistics:function(){var st={};for(var ind in this.items){var val=this.items[ind];val.count?st[val.part]=val.count:(st[val.part]="?",this.expand(val.id,val.url,!1,[function(json,st,part){st[part]=json.count},st,val.part]))}this.select=st,this.selected=!0}}});window.addEventListener("popstate",Main.forcePage)});